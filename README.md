# Report

```

&НаСервере
Процедура СформироватьНаСервере()
	ДатаНачала=Период.ДатаНачала;
	ДатаОкончания=Период.ДатаОкончания; 
	
	ПлатежныйКалендарь.Очистить();
	
	ТабДок=Новый ТабличныйДокумент;	
 	Макет=РеквизитФормыВЗначение("Объект").ПолучитьМакет("Макет");  	
	
	ОбластьШапкаТаблицыОсновная = Макет.ПолучитьОбласть("ШапкаТаблицы|Основная");
	ТабДок.Вывести(ОбластьШапкаТаблицыОсновная);	
	
	ТекДата=КонецДня(Период.ДатаНачала);  
	Пока ТекДата<=ДатаОкончания Цикл
		ОбластьШапкаТаблицыДополнительная = Макет.ПолучитьОбласть("ШапкаТаблицы|Дополнительная");
		ОбластьШапкаТаблицыДополнительная.Параметры.Дата=Формат(ТекДата, "ДФ=dd.MM.yyyy");
		ТабДок.Присоединить(ОбластьШапкаТаблицыДополнительная);
		ТекДата = ТекДата + 86400;
    КонецЦикла;
	ОбластьОстатокНаНачалоОсновная = Макет.ПолучитьОбласть("ШапкаОстатокНаНачало|Основная");
	ТабДок.Вывести(ОбластьОстатокНаНачалоОсновная); 
	
	ТекДата=КонецДня(Период.ДатаНачала);  
	Пока ТекДата<=ДатаОкончания Цикл   
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	СУММА(ДвиженияДСОстатки.ДенежныеСредстваОстаток) КАК ДенежныеСредстваОстаток
			|ИЗ
			|	РегистрНакопления.ДвиженияДС.Остатки(&ДатаНачала, ) КАК ДвиженияДСОстатки";
		
		Запрос.УстановитьПараметр("ДатаНачала", ТекДата-86400);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		ОстатокНаНачало=0;
		Пока ВыборкаДетальныеЗаписи.Следующий() цикл
			ОстатокНаНачало=ВыборкаДетальныеЗаписи.ДенежныеСредстваОстаток;
		КонецЦикла;
		
		ОбластьОстатокНаНачалоДополнительная = Макет.ПолучитьОбласть("ШапкаОстатокНаНачало|Дополнительная");
		ОбластьОстатокНаНачалоДополнительная.Параметры.ОстатокНаНачало=ОстатокНаНачало;
		
		ТабДок.Присоединить(ОбластьОстатокНаНачалоДополнительная);    
		ТекДата = ТекДата + 86400;
	
	КонецЦикла;
	

	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДвиженияДС.Период КАК Период,
		|	ДвиженияДС.Контрагент КАК Контрагент,
		|	ДвиженияДС.Документ КАК Документ,
		|	ДвиженияДС.ВидОперации КАК ВидОперации,
		|	ДвиженияДС.Договор КАК Договор,
		|	ДвиженияДС.ДенежныеСредства КАК ДенежныеСредства
		|ИЗ
		|	РегистрНакопления.ДвиженияДС КАК ДвиженияДС
		|ГДЕ
		|	ДвиженияДС.Период >= &НачалоПериода
		|	И ДвиженияДС.Период <= &КонецПериода
		|	И ДвиженияДС.Активность = ИСТИНА
		|
		|УПОРЯДОЧИТЬ ПО
		|	ВидОперации,
		|	Контрагент,
		|	Документ
		|ИТОГИ
		|	СУММА(ДенежныеСредства) 
		|ПО
		|	ВидОперации,
		|	Контрагент,
		|	Договор,
		|	Документ,
		|	Период";
	
	Запрос.УстановитьПараметр("КонецПериода", ДатаОкончания);
	Запрос.УстановитьПараметр("НачалоПериода", ДатаНачала);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выгрузить();
		
	ВыборкаВидОперации = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам); 
	
    
	ТабДок.НачатьАвтоГруппировкуСтрок();	
	Пока ВыборкаВидОперации.Следующий() Цикл		
		ОбластьСодержимоеТаблицыОсновная = Макет.ПолучитьОбласть("СодержимоеТаблицы|Основная");
		ОбластьСодержимоеТаблицыОсновная.Параметры.ВидОперации=ВыборкаВидОперации.ВидОперации;
		ТабДок.Вывести(ОбластьСодержимоеТаблицыОсновная); 

		
		ВыборкаКонтрагент=ВыборкаВидОперации.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		Пока ВыборкаКонтрагент.Следующий() Цикл 			
			ОбластьСодержимоеТаблицыОсновная = Макет.ПолучитьОбласть("СодержимоеТаблицы|Основная");
			ОбластьСодержимоеТаблицыОсновная.Параметры.Контрагент=ВыборкаКонтрагент.Контрагент;
			ТабДок.Вывести(ОбластьСодержимоеТаблицыОсновная);                   

			
			ВыборкаДоговор=ВыборкаКонтрагент.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			
			Пока ВыборкаДоговор.Следующий() Цикл                				
				ОбластьСодержимоеТаблицыОсновная = Макет.ПолучитьОбласть("СодержимоеТаблицы|Основная");
				ОбластьСодержимоеТаблицыОсновная.Параметры.Договор=ВыборкаДоговор.Договор;
				ТабДок.Вывести(ОбластьСодержимоеТаблицыОсновная); 

				
				ВыборкаДокумент=ВыборкаДоговор.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			
				Пока ВыборкаДокумент.Следующий() Цикл
						
					ОбластьСодержимоеТаблицыОсновная = Макет.ПолучитьОбласть("СодержимоеТаблицы|Основная");  
					ОбластьСодержимоеТаблицыОсновная.Параметры.Договор=ВыборкаДокумент.Документ;
					ТабДок.Вывести(ОбластьСодержимоеТаблицыОсновная);  
					
					ВыборкаПериод=ВыборкаДокумент.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					Пока ВыборкаПериод.Следующий() Цикл  
						ОбластьСодержимоеТаблицыДополнительная = Макет.ПолучитьОбласть("СодержимоеТаблицы|Дополнительная");
						ТекДата=КонецДня(Период.ДатаНачала);
						Пока ТекДата<=ВыборкаПериод.Период цикл
							ТабДок.Присоединить(ОбластьСодержимоеТаблицыДополнительная);
							ТекДата = ТекДата + 86400;
						КонецЦикла;   
						ОбластьСодержимоеТаблицыДополнительная.Параметры.СуммаПоДокументу=ВыборкаПериод.ДенежныеСредства;	
						ТабДок.Присоединить(ОбластьСодержимоеТаблицыДополнительная);

						
					КонецЦикла; 
				КонецЦикла;

			КонецЦикла;
			
		КонецЦикла;
	КонецЦикла;  
	ТабДок.ЗакончитьАвтогруппировкуСтрок();
	ОбластьОстатокНаКонецОсновная = Макет.ПолучитьОбласть("ШапкаОстатокНаКонец|Основная");
	ТабДок.Вывести(ОбластьОстатокНаКонецОсновная); 
	
	ТекДата=КонецДня(Период.ДатаНачала);  
	Пока ТекДата<=ДатаОкончания Цикл   
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	СУММА(ДвиженияДСОстатки.ДенежныеСредстваОстаток) КАК ДенежныеСредстваОстаток
			|ИЗ
			|	РегистрНакопления.ДвиженияДС.Остатки(&ДатаНачала, ) КАК ДвиженияДСОстатки";
		
		Запрос.УстановитьПараметр("ДатаНачала", ТекДата);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		ОстатокНаКонец=0;
		Пока ВыборкаДетальныеЗаписи.Следующий() цикл
			ОстатокНаКонец=ВыборкаДетальныеЗаписи.ДенежныеСредстваОстаток;
		КонецЦикла;
		
		ОбластьОстатокНаКонецДополнительная = Макет.ПолучитьОбласть("ШапкаОстатокНаКонец|Дополнительная");
		ОбластьОстатокНаКонецДополнительная.Параметры.ОстатокНаКонец=ОстатокНаКонец;
		
		ТабДок.Присоединить(ОбластьОстатокНаКонецДополнительная);    
		ТекДата = ТекДата + 86400;
	
	КонецЦикла;
	

	

	ПлатежныйКалендарь=ТабДок;
КонецПроцедуры

&НаКлиенте
Процедура Сформировать(Команда)
	Если ЗначениеЗаполнено(Период) Тогда 
		СформироватьНаСервере();   
	Иначе 
		Сообщить("Введите период");
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура СформироватьБПНаСервере()
	БПСогласование.Отбор.Элементы.Очистить();
	БПОтбор=БПСогласование.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	БПОтбор.ЛевоеЗначение=Новый ПолеКомпоновкиДанных("Завершен"); 
	БПОтбор.ВидСравнения=ВидСравненияКомпоновкиДанных.Равно;
	БПОтбор.ПравоеЗначение=Ложь;
КонецПроцедуры

&НаКлиенте
Процедура СформироватьБП(Команда)
	СформироватьБПНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	БПОтбор=БПСогласование.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	БПОтбор.ЛевоеЗначение=Новый ПолеКомпоновкиДанных("СсылкаНаДокумент"); 
	БПОтбор.ВидСравнения=ВидСравненияКомпоновкиДанных.Равно;
	БПОтбор.ПравоеЗначение="";
КонецПроцедуры

```
